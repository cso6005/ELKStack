# phrase match
여러 개의 용어를 입력한 용어의 순서까지 검색하고 싶을 때 사용한다.

match 쿼리는 용어들을 독립적으로 취급해 포함되면 검색되지만, phrase match 는 용어의 순서까지 일치해야 한다.

역인덱스가 문서 내에 있는 용어 뿐만 아니라, **용어가 발생하는 순서까지 저장**하기에 

각 용어의 발생 순서에 관한 정보를 사용하여 구절이 존재하는 위치를 찾을 수 있다.

> ex. 아래 예제는 디폴트 설정으로 두 용어가 바로 옆에 순서 붙어 있어야 검색된다.
> 
> star wars 라는 구절 전체를 요구하기 때문에
> 
> star trek 은 포함되지 않는다. wars star 또한 포함되지 않는다.
~~~
{
    "query": {
        "match_phrase": {
            "title": "star wars"
        }
    }
}
~~~

### slop 

**용어가 어느 방향으로 '얼마나' 움직여도** 구절 매치르 허용할 것인지를 조정하는 파라미터.

즉, 해당 크기만큼 중간에 다른 용어가 있거나, 다른 순서로 배치되어도 포함된다.

이를 이용한다면 다양한 단어들을 포함해 매치하거나, 반전된 구절도 매치할 수 있다.

>ex. quick fox 라는 구절을 검색하는데 slop 을 1로 설정한다면, 
>
>quick brown fox, fox quick 구절도 매치된다. 
>
> ?? fox brown quick 은 안되겟지..?

~~~
{
    "query": {
        "match_phrase": {
            "title": {
                "query": "star wars", "slop":1 
            }
        }
    }
}
~~~

### Proximity Queries

두 용어가 서로 가까이 사용된 문서에 더 높은 관련성을 부여하고자 하는 경우,

이 match_phrase 의 slop 를 이용해, proximity 쿼리를 사용하면 된다.

> ex. slop = 100 으로 설정하면, 두 검색어 사이에 다른 용어 100개까지 있어도 관련 문서로 포함된다.
> 
> 이때, 두 용어가 서로 더 가까이 있을 수록 relevance 점수가 높아지게 된다.
> 
> 이렇게 가까이 있을수록 좋은 두 개의 검색어를 검색할 때 해당 쿼리를 이용한다.

~~~
{
    "query": {
        "match_phrase": {
            "title": {
                "query": "star wars", "slop":100
            }
        }
    }
}
~~~