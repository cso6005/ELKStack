# 1. Request body search
- 실무에선 request body search 를 사용하며, 이 본문은 json 형태로 요청으로 보낸다.
- URL 인코딩을 할 필요가 없기 때문에 암호화된 문자를 다룰 필요가 없다.
- search 뿐만 아니라, 본문이 필요한 요청에서도 json 형태를 쓸 수 있다.


> 검색 유형에는 크게 Queries 과 Filters 가 있다.

# 2. filters
- 조건을 만족하지 않는 문서는 제외하고 반환
- yes or no 결과를 가져오는 바이너리 작업에는 쿼리보다 필터를 쓰는 게 더 효율적이다.
  - 속도가 더 빠를 뿐만 아니라, es 에 의해 결과가 저장되기 때문에 또 다른 쿼리를 수행할 때 같은 필터를 사용하면 휠씬 더 빠르다.

### 1. term
- 정확한 용어나 값으로 필터링해야 하는 경우.
- 연도가 2024 년인 결과만 나옴.
~~~
{"term":{"year":2024}}
~~~

### 2. terms
- 여러 값을 대상으로 정확한 용어나 값으로 필터링해야 하는 경우
- "Sci-Fi"나 "Adventure"라는 장르를 가진 항목들을 필터링
~~~
{"terms":{"genre":["Adventure", "Sci-Fi"]}}
~~~

### 3. range
- 범위 검색
- gt 초과, gte 이상, lt 미만, lte 이하

### 4. exists 
- 지정된 필드가 있는 문서를 찾음.
~~~
{"exists":{"field":"tags"}}
~~~

### 5. missing
- 지정된 필드가 없는 문서를 찾음.
~~~
{"missing":{"field":"tags"}}
~~~

### 6. bool
- 조건에 따라 필터링
- **복합 쿼리**에서 사용
- must : and 모두 만족하는
- must_not : not 모두 일치하지 않는
- should : or 하나라도 만족하는

# 3. queries
- 검색어가 주어진 문서에 얼마나 관련있는지에 대한 관련성 순서로 결과를 얻기 원할 때
- 관련도에 따라 순위가 매긴 분석된 결과로

### 1. match_all
- 모든 문서를 받고 싶을 때 주로 사용.
- 쿼리를 지정하지 않으면, 기본적으로 모든 결과가 반환됨.
~~~
{
    "match_all":{}
}
~~~

### 2. match
- 특정 검색어에 대한 관련 검색
~~~
{
    "match":{
        "title":"star"
    }
}
~~~

### 3. multi_match
- 여러 필드를 대상으로 쿼리
~~~
{
    "multi_match":{
        "query":"star",
        "fields":["title", "synopsis"]
    }
}
~~~

### 4. bool
- 쿼리 검색에서도 쓸 수 있음.
- 필터처럼 bool 조건을 **충족하지 않는 결과를 필터링하는 게 아니라, 관련성 별로 결과를 순위대로 표시**한다.


:star: 구문 쿼리는 쿼리 블록으로 싸여 있고, 필터는 필터 블록으로 싸여 있다. 그리고 **쿼리 내에서 필터를 사용하거나 필터 내에서 쿼리를 사용할** 수 있다. 

이렇게 **필터와 쿼리를 결합**하면 우리가 원하는 결과를 도출하기 위한 작업을 할 수 있다.

### ex. 제목에 trek이 포함되어 있어야 하며 출시연도가 2010년보다 크거나 같아야 함.
~~~
{
    "query":{
        "bool":{
            "must":{"term":{
                "title":"trek"
                }
            },
            "filter":{
                "range": {
                    "year":{"gte":2010}
                }
            }
        }
    }
}
~~~

